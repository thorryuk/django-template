{% extends 'pln/backend/layout/base_layout.html' %}
{% load static %}

{% block css %}
    <link rel="stylesheet" href="{% static '/assets/vendor_plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.css' %}">
{% endblock %}

{% block javascript %}
    <script src="{% static '/assets/vendor_plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.js' %}"></script>

    <script type="text/javascript">

        $(function () {
            $("#compose-textarea").wysihtml5();
          });

        $(document).ready(function(){

            $('#button_add_attachment').click(function(){

                var new_row = '<tr>';
                new_row += '<td><input type="file" name="attachments[]" class="form-control"></td>';
                new_row += '<td><button type="button" class="btn btn-red"><i class="fa fa-trash"></i></button></td>';
                new_row += '</tr>';
                $('#table_attachments tbody').append(new_row);
            });

            $('#table_attachments').on('click', 'button', function(){
                $(this).closest('tr').remove();
            });
        });

    </script>

{% endblock %}


{% block content %}

{% if request.COOKIES.success_msg %}
    <div class="alert alert-success alert-dismissable">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                {{ request.COOKIES.success_msg }} </div>
{% endif %}

{% if request.COOKIES.error_msg %}
    <div class="alert alert-danger alert-dismissable">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                {{ request.COOKIES.error_msg }} </div>
{% endif %}


<div class="box">
    <div class="box-header with-border">
        <h3 class="box-title">Compose Quotation Mail</h3>
    </div>
    <div class="box-body">
        <div class="col-12">
            <div class="box bg-gray">
                <div class="box-body">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="box p-20">
                                <form enctype="multipart/form-data" method="post">
                                    {% csrf_token %}
                                <div class="box-header with-border">
                                    <h4 class="box-title">Compose</h4>
                                    <!-- /.box-tools -->
                                </div>
                                <!-- /.box-header -->
                                <div class="box-body">
                                    <table class="table editable-table m-b-0">
                                        <tr>
                                            <td style="width: 10%; ">To<span class="required_field">*</span> : </td>
                                            <td style="width: 90%"><input class="form-control" value="{{default_receiver}}" disabled> </td>
                                        </tr>
                                        <tr>
                                            <td>Subject<span class="required_field">*</span> :  </td>
                                            <td><input class="form-control" name="subject" autocomplete="off" id="subject" value="{{ default_subject }}">  </td>
                                        </tr>
                                    </table>
                                    <div class="form-group text-dark">
                                        <textarea id="compose-textarea" name="body_mail" autocomplete="off" class="form-control h-300">
                                            {{ default_body }}
                                        </textarea>
                                    </div>
                                    <div class="form-group">
                                        <button type="button" id="button_add_attachment" class="btn btn-info btn-file">
                                            <i class="fa fa-paperclip"></i> Add Attachment
                                        </button>

                                        <table class="table" id="table_attachments">
                                        <tbody>

                                      </tbody></table>

                                    </div>
                                </div>
                                <!-- /.box-body -->
                                <div class="box-footer">
                                    <div class="pull-right">
                                        <button type="submit" class="btn btn-success"><i class="fa fa-envelope-o"></i> Send</button>
                                    </div>
                                    <a href="{% url 'quotation_detail' id=id %}" class="btn btn-red"><i class="fa fa-times"></i> Discard</a>
                                </div>
                                <!-- /.box-footer -->
                                </form>
                            </div>
                            <!-- /. box -->
                        </div>
                        <div class="col-md-4">
                            <div class="box h-p100 p-20">
                                <div class="box-header with-border">
                                    <h4 class="box-title">History Send Quotation Mail</h4>
                                </div>
                                <div class="box-body">
                                    <table class="table table-responsive">
                                        <tbody><tr>
                                          <th style="width: 10px">#</th>
                                          <th>Date</th>
                                          <th>Sender</th>
                                          <th>Receiver</th>
                                        </tr>
                                        {% for mail_history in mail_histories %}
                                            <tr>
                                              <td>{{ forloop.counter }}</td>
                                              <td>{{ mail_history.date|date:"d M Y H:i:s"}}</td>
                                              <td>{{ mail_history.froms }}</td>
                                              <td>{{ mail_history.to }}</td>
                                            </tr>
                                        {% empty %}
                                            <tr>
                                              <td colspan="4">No Data</td>
                                            </tr>
                                        {% endfor %}

                                      </tbody></table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}